# Ручная установка приложения поиска изображений

Используйте эту инструкцию, если автоматическая установка через `install.bat` не работает.

## ⭐ Новые возможности

В этой версии добавлены:

- **Современный интерфейс результатов**: Замена Canvas на Treeview с улучшенной прокруткой
- **Устранение ограничений**: Теперь без лимита на количество элементов в результатах
- **Модульная архитектура UI**: Отдельные компоненты в папке `ui/`
- **Диагностика системы**: Новый файл `system_check.py` для проверки готовности
- **Умное обновление**: Скрипт `smart_update.bat` для сохранения настроек

См. подробности в файлах: `USER_GUIDE.md`, `REFACTORING_SUMMARY.md` и основном `README.md`

## Шаг 1: Проверка Python

Откройте командную строку (Win+R → cmd → Enter) и выполните:

```
python --version
```

Должна отобразиться версия Python 3.8 или выше. Если команда не найдена:

1. Скачайте Python с https://python.org/downloads/
2. При установке обязательно поставьте галочку "Add Python to PATH"
3. Перезагрузите компьютер после установки

## Шаг 2: Переход в папку приложения

В командной строке перейдите в папку с файлами приложения:

```
cd C:\путь\к\папке\с\приложением
```

Например:

```
cd C:\ImageSearch
```

## Шаг 3: Создание виртуального окружения (рекомендуется)

```
python -m venv venv
```

Если команда выполнилась успешно, активируйте окружение:

```
venv\Scripts\activate
```

В командной строке должно появиться `(venv)`.

## Шаг 4: Обновление pip

```
python -m pip install --upgrade pip
```

## Шаг 5: Установка зависимостей

### Вариант A: Установка из requirements.txt

```
pip install -r requirements.txt
```

### Вариант B: Пошаговая установка (если Вариант A не работает)

```
pip install torch torchvision --index-url https://download.pytorch.org/whl/cpu
pip install sentence-transformers
pip install Pillow
pip install numpy
pip install psutil
```

## Шаг 6: Проверка установки

```
python -c "import torch; print('PyTorch OK')"
python -c "import sentence_transformers; print('sentence-transformers OK')"
python -c "from PIL import Image; print('Pillow OK')"
python -c "import numpy; print('numpy OK')"
python -c "import psutil; print('psutil OK')"
```

Все команды должны выполниться без ошибок.

## Шаг 7: Диагностика системы (рекомендуется)

Запустите проверку готовности системы:

```
python system_check.py
```

Этот скрипт проверит:

- Версию Python
- Доступность GPU
- Объем свободной памяти
- Установленные зависимости
- Корректность настроек

## Шаг 8: Создание папки кэша

```
mkdir cache
```

## Шаг 9: Запуск приложения

```
python main.py
```

## Возможные проблемы и решения

### Ошибка "Microsoft Visual C++ 14.0 is required"

Скачайте и установите "Microsoft C++ Build Tools" с официального сайта Microsoft.

### Ошибка при установке torch

Попробуйте установить CPU версию:

```
pip install torch torchvision --index-url https://download.pytorch.org/whl/cpu
```

Для GPU поддержки (NVIDIA):

```
pip install torch torchvision --index-url https://download.pytorch.org/whl/cu118
```

### Проблемы с интерфейсом результатов

Если результаты поиска отображаются некорректно, убедитесь что:

1. Установлена актуальная версия tkinter
2. Используется новый интерфейс на основе Treeview
3. Нет конфликтов с другими GUI библиотеками

### Ошибки модульной структуры

Если возникают ошибки импорта модулей из папки `ui/`:

1. Убедитесь, что папка `ui/` содержит файл `__init__.py`
2. Проверьте, что вы запускаете приложение из корневой папки проекта

### Ошибка "No module named '\_tkinter'"

Tkinter должен быть включен в стандартную установку Python. Если его нет, переустановите Python с официального сайта.

### Приложение запускается, но не может загрузить модель

Убедитесь, что у вас есть стабильное интернет-соединение. При первом запуске загружается модель (~500 МБ).

## Создание ярлыка

После успешной установки создайте файл `start.bat` в папке приложения:

```batch
@echo off
cd /d "%~dp0"
if exist "venv\Scripts\activate.bat" call venv\Scripts\activate.bat
python main.py
pause
```

Или используйте существующий файл `run.bat`, если он есть.

## Проверка работы

1. Запустите диагностику: `python system_check.py`
2. Запустите приложение: `python main.py`
3. Выберите папку с несколькими изображениями
4. Нажмите "Построить индекс"
5. После завершения попробуйте поиск
6. Проверьте новый табличный интерфейс результатов с сортировкой

## Дополнительные возможности

### GPU ускорение

Для настройки GPU поддержки используйте:

```
python gpu_setup.py
```

### Обновление зависимостей

Если нужно обновить зависимости без потери настроек:

```
python -m pip install --upgrade -r requirements.txt
```

### Очистка кэша

Для очистки кэша и освобождения места:

```
# Удалить все файлы кэша
rmdir /s cache
mkdir cache
```

Если все работает корректно, приложение готово к использованию с новым улучшенным интерфейсом!
